name: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è YML-—Ñ–∏–¥–∞

on:
  schedule:
    # üï∞ –ó–∞–ø—É—Å–∫ –∫–∞–∂–¥—É—é –Ω–µ–¥–µ–ª—é –≤ –≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ –≤ 00:00
    - cron: '0 21 * * 0'
  workflow_dispatch:  # –ü–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–ø—É—Å—Ç–∏—Ç—å –≤—Ä—É—á–Ω—É—é
    inputs:
      debug:
        description: '–ó–∞–ø—É—Å—Ç–∏—Ç—å –≤ —Ä–µ–∂–∏–º–µ –æ—Ç–ª–∞–¥–∫–∏'
        required: false

jobs:
  generate-feed:
    runs-on: ubuntu-latest
    timeout-minutes: 30

    steps:
      - name: üõé Checkout –∫–æ–¥–∞
        uses: actions/checkout@v4

      - name: üêç –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: üîß –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
        run: |
          pip install -r requirements.txt
          playwright install chromium

      - name: üïπ –ó–∞–ø—É—Å–∫ –ø–∞—Ä—Å–µ—Ä–∞
        run: |
          python feed.py

      - name: üìÇ –ü—Ä–æ–≤–µ—Ä–∫–∞, —Å–æ–∑–¥–∞–Ω –ª–∏ —Ñ–∏–¥
        run: |
          if [ ! -f "output/paomma_catalog.xml" ]; then
            echo "‚ùå –§–∏–¥ –Ω–µ –±—ã–ª —Å–æ–∑–¥–∞–Ω!"
            exit 1
          fi
          echo "‚úÖ –§–∏–¥ —É—Å–ø–µ—à–Ω–æ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω"

      - name: üåê –ù–∞—Å—Ç—Ä–æ–π–∫–∞ GitHub Pages
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./output
          publish_branch: pages  # –í–µ—Ç–∫–∞ –¥–ª—è GitHub Pages
          commit_message: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ñ–∏–¥–∞ (–∞–≤—Ç–æ) $(date)
